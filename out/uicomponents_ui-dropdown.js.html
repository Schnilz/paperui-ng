

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>JSDoc: uicomponents/ui-dropdown.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                     
                        <img src="assets/img/openhab-logo.svg" alt="logo">
                    
                     
                        <h1 class="navbar-item">Setup&Maintenance JS Documentation</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                 
                <div class="navbar-menu">
                    <div class="navbar-end">
                    
                        <div class="navbar-item">
                            <a href="https://github.com/davidgraeff/paperui-ng" target="_blank">Github</a>
                        </div>
                    
                        <div class="navbar-item">
                            <a href="https://davidgraeff.github.io/paperui-ng/" target="_blank">The application</a>
                        </div>
                    
                    </div>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3><a href="global.html">Global</a></h3></div><div class="category"><h2>App</h2><h3>Modules</h3><ul><li><a href="module-app.html">app</a></li></ul><h3>Classes</h3><ul><li><a href="module-app.exports.StorageConnector.html">exports.StorageConnector</a></li></ul></div><div class="category"><h2>Data Components</h2><h3>Modules</h3><ul><li><a href="module-ohcomponents.html">ohcomponents</a></li></ul><h3>Externals</h3><ul><li><a href="oh-change-filter.html">oh-change-filter</a></li><li><a href="oh-doc-link.html">oh-doc-link</a></li><li><a href="oh-dropdown-bind.html">oh-dropdown-bind</a></li><li><a href="oh-event-bind.html">oh-event-bind</a></li><li><a href="oh-form-bind.html">oh-form-bind</a></li><li><a href="oh-list-bind.html">oh-list-bind</a></li><li><a href="oh-login-status-link.html">oh-login-status-link</a></li><li><a href="oh-nav-auto-link.html">oh-nav-auto-link</a></li><li><a href="oh-prop-bind.html">oh-prop-bind</a></li><li><a href="oh-script-snippets.html">oh-script-snippets</a></li><li><a href="oh-tutorial-starter.html">oh-tutorial-starter</a></li><li><a href="oh-vue-bind.html">oh-vue-bind</a></li><li><a href="oh-websocket-data.html">oh-websocket-data</a></li></ul><h3>Classes</h3><ul><li><a href="UpdateAdapter.html">UpdateAdapter</a></li></ul><h3>Events</h3><ul><li><a href="oh-websocket-data.html#event:data">data</a></li></ul></div><div class="category"><h2>Rules</h2><h3>Modules</h3><ul><li><a href="module-rule.html">rule</a></li></ul><h3>Classes</h3><ul><li><a href="module-rule.ImportExport.html">ImportExport</a></li><li><a href="module-rule.LayoutManager.html">LayoutManager</a></li><li><a href="module-rule.OHCaptionComponent.html">OHCaptionComponent</a></li><li><a href="module-rule.OHRuleComponent.html">OHRuleComponent</a></li></ul></div><div class="category"><h2>Webworker Storage Model</h2><h3>Modules</h3><ul><li><a href="module-storage-webworker.html">storage-webworker</a></li></ul><h3>Classes</h3><ul><li><a href="module-storage-webworker.StateWhileRevalidateStore.html">StateWhileRevalidateStore</a></li><li><a href="module-storage-webworker-StorageWorker.html">StorageWorker</a></li></ul></div><div class="category"><h2>Tutorial</h2><h3>Modules</h3><ul><li><a href="module-tutorial.html">tutorial</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-tutorial.Tools.html">Tools</a></li></ul></div><div class="category"><h2>Web Components</h2><h3>Modules</h3><ul><li><a href="module-ui-cron-expression.html">ui-cron-expression</a></li><li><a href="module-ui-maps.html">ui-maps</a></li><li><a href="module-ui-time-graph.html">ui-time-graph</a></li><li><a href="module-ui-time-picker.html">ui-time-picker</a></li><li><a href="module-uicomponents.html">uicomponents</a></li></ul><h3>Externals</h3><ul><li><a href="nav-ajax-page-load.html">nav-ajax-page-load</a></li><li><a href="nav-breadcrumb.html">nav-breadcrumb</a></li><li><a href="nav-buttons.html">nav-buttons</a></li><li><a href="oh-rule-editor.html">oh-rule-editor</a></li><li><a href="ui-changelog.html">ui-changelog</a></li><li><a href="ui-codeeditor.html">ui-codeeditor</a></li><li><a href="ui-community-topics.html">ui-community-topics</a></li><li><a href="ui-context-help.html">ui-context-help</a></li><li><a href="ui-cron-expression.html">ui-cron-expression</a></li><li><a href="ui-drop-zone.html">ui-drop-zone</a></li><li><a href="ui-dropdown.html">ui-dropdown</a></li><li><a href="ui-filter.html">ui-filter</a></li><li><a href="ui-github-issues.html">ui-github-issues</a></li><li><a href="ui-maps.html">ui-maps</a></li><li><a href="ui-multiselect.html">ui-multiselect</a></li><li><a href="ui-notification.html">ui-notification</a></li><li><a href="ui-switch.html">ui-switch</a></li><li><a href="ui-tabs.html">ui-tabs</a></li><li><a href="ui-tags.html">ui-tags</a></li><li><a href="ui-time-graph.html">ui-time-graph</a></li><li><a href="ui-time-picker.html">ui-time-picker</a></li><li><a href="ui-youtube.html">ui-youtube</a></li></ul><h3>Events</h3><ul><li><a href="ui-tags.html#event:input">input</a></li></ul></div><div class="category"><h2>Web Components (Reactive)</h2><h3>Modules</h3><ul><li><a href="module-vue.html">vue</a></li></ul><h3>Externals</h3><ul><li><a href="oh-vue.html">oh-vue</a></li><li><a href="oh-vue-form.html">oh-vue-form</a></li><li><a href="oh-vue-list.html">oh-vue-list</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>uicomponents/ui-dropdown.js</h1>
                    </header>
                    
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { html, render } from 'lit-html';

/**
 * @category Web Components
 * @customelement ui-dropdown
 * @description A dropdown component.
 * @attribute novalue Will not apply the selected entry as new value, only emits an input event
 * @attribute editable If set, displays an input box instead of a label
 * @attribute allowunset If set, shows a clear option
 * @attribute icons If set, displays an icon for each option. The icon file path is like: img/{icon}/{key}.png
 * @attribute required If set, this element is required within a &lt;form>.
 * @attribute options The options to show as a comma separated string. You should prefer the options property instead.
 * @example &lt;caption>A dropdown example&lt;/caption>
 * &lt;ui-dropdown>&lt;/ui-dropdown>
 */
class UiDropdown extends HTMLElement {
  constructor() {
    super();
  }
  connectedCallback() {
    if (this.hasAttribute("viewkey")) this.viewkey = this.getAttribute("viewkey");
    if (this.hasAttribute("desckey")) this.desckey = this.getAttribute("desckey");
    if (this.hasAttribute("valuekey")) this.valuekey = this.getAttribute("valuekey");
    this.allowunset = this.hasAttribute("allowunset");
    this.editable = this.hasAttribute("editable");
    this.novalue = this.hasAttribute("novalue");
    this.nostate = this.hasAttribute("nostate");
    this.icons = this.hasAttribute("icons") ? this.getAttribute("icons") : null;
    this.required = this.hasAttribute("required");

    this.bodyClickBound = (e) => this.bodyClicked(e);
    this.addEventListener("click", e => e.stopPropagation());
    this.classList.add("dropdown");
    const classes = this.hasAttribute("btnclass") ? this.getAttribute("btnclass") : "btn btn-primary-hover btn-sm";

    let controlChild = null;
    if (this.firstElementChild == null) {
      controlChild = document.createElement("div");
      if (this.editable) {
        render(html`
            &lt;input class="${classes} dropdown-toggle label" aria-haspopup="true" aria-expanded="false">`, controlChild);
      } else {
        render(html`
            &lt;button class="${classes} dropdown-toggle" type="button" aria-haspopup="true" aria-expanded="false">&lt;span class="label">&lt;/span>&lt;/button>`, controlChild);
      }
      controlChild = this.appendChild(controlChild.firstElementChild)
    } else {
      controlChild = this.firstElementChild;
    }
    controlChild.addEventListener("click", this.toggleShow.bind(this), { passive: true });

    const el = document.createElement("div"); el.classList.add("dropdown-menu");
    this.dropdownEl = this.appendChild(el);
    this.labelEl = this.querySelector(".label");
    if (!this.labelEl) throw new Error("Render failed");

    if (this._options) this.options = this._options;
    if (this.hasAttribute("options")) this.attributeChangedCallback("options");
    if (this.hasAttribute("value"))
      this.attributeChangedCallback("value");
    else
      this.value = this._value;
  }
  disconnectedCallback() {
    while (this.firstChild) { this.firstChild.remove(); }
  }
  static get observedAttributes() {
    return ['value'];
  }
  attributeChangedCallback(name, oldValue, newValue) {
    if (name == "value") this.value = this.getAttribute("value");
    if (name == "options") {
      const options = {};
      const items = this.getAttribute("options").split(",");
      for (let item of items) {
        const data = item.split(":");
        if (data.length == 1) options[item] = { label: item };
        else options[data[0].trim()] = { label: data[1].trim() };
      }
      this.options = options;
    }
  }
  toggleShow() {
    if (this.dropdownEl.classList.contains("show")) this.close(); else this.open();
  }
  bodyClicked(e) {
    this.closeTimer = setTimeout(() => this.close(), 50);
  }
  close() {
    this.dropdownEl.classList.remove("show");
  }
  open() {
    if (this.closeTimer) { clearTimeout(this.closeTimer); delete this.closeTimer; }
    document.body.addEventListener("click", this.bodyClickBound, { once: true, passive: true, capture: true });
    this.dropdownEl.classList.add("show");
  }
  set value(key) {

    this._value = key;
    if (!this.dropdownEl) return;

    if (key == null || key == undefined || key == "" || !this._options) {
      if (this.editable) {
        this.labelEl.placeholder = this.getAttribute("label");
        this.labelEl.value = "";
      } else
        this.labelEl.innerHTML = this.getAttribute("label");
      return;
    }

    if (!this.novalue &amp;&amp; this._options &amp;&amp; this._options[key]) {
      const option = this._options[key];
      if (this.editable)
        this.labelEl.value = option.label;
      else
        this.labelEl.innerHTML = option.label;
      this.labelEl.title = option.desc || "";
    }
    this._value = key;
    // Change active marker
    let selectedEl = this.dropdownEl.querySelector(".active");
    if (selectedEl) selectedEl.classList.remove("active");
    selectedEl = this.dropdownEl.querySelector("a[data-key='" + key + "']");
    if (selectedEl) selectedEl.classList.add("active");
  }
  get value() {
    return this._value;
  }
  get options() {
    return this._options;
  }
  // We allow arrays as well as object(key:{label,desc}) mappings
  set options(newValue) {
    this._options = newValue;
    if (!this.dropdownEl) return;

    if (Array.isArray(newValue)) {
      if (!this.viewkey || !this.valuekey) {
        console.warn("No viewkey/valuekey set!");
        return;
      }
      const options = {};
      for (let entry of newValue) {
        const key = entry[this.valuekey];
        const label = entry[this.viewkey];
        const desc = entry[this.desckey];
        options[key] = { label, desc };
      }
      newValue = options;
    }
    this._options = newValue;

    while (this.dropdownEl.firstChild) { this.dropdownEl.firstChild.remove(); }
    for (let key of Object.keys(this._options)) {
      const option = this._options[key];
      const a = document.createElement("div");
      a.classList.add("dropdown-item");
      a.dataset.key = key;
      a.addEventListener("click", (event) => this.select(event.target.dataset.key, event));
      let img = this.icons ? `&lt;img src="img/${this.icons}/${key}.png">` : "";
      if (option.desc)
        a.innerHTML = `${img}&lt;div>&lt;b>${option.label}&lt;/b>&lt;br>&lt;div class="small">${option.desc}&lt;/div>&lt;/div>`;
      else
        a.innerHTML = `${img}&lt;div>${option.label}&lt;/div>`;
      this.dropdownEl.appendChild(a);
    }

    this.value = this._value;
  }
  select(key, event) {
    if (event) event.preventDefault();
    this.dropdownEl.classList.remove("show");
    document.body.removeEventListener("click", this.bodyClickBound, { once: true, passive: true, capture: true });
    if (!this.nostate) this.value = key;
    this.dispatchEvent(new CustomEvent("input", { detail: key }));
  }
}

customElements.define('ui-dropdown', UiDropdown);</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>

<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Apr 16 2019 18:12:34 GMT+0000 (Coordinated Universal Time)</p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers</a>
        </p>
    </div>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/app.min.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
